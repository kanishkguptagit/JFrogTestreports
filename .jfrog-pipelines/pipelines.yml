resources:
  - name: myRepoResource
    type: GitRepo
    configuration:
      gitProvider: int_github
      path: kanishkguptagit/JFrogTestreports
      branches:
        include: master

  - name: myPropertyBag
    type: PropertyBag
    configuration:
      STEP_ID: value

pipelines:
  - name: TestReports
    steps:
      - name: GenerateReports
        type: Bash
        configuration:
          inputResources:
            - name: myRepoResource
          outputResources:
            - name: myPropertyBag
        execution:
          onExecute:
            - save_tests "$res_myRepoResource_resourcePath/tests/junit/test_results_example_1.xml"
            - write_output myPropertyBag "STEP_ID=${step_id}"
            - write_output myPropertyBag "STEP_URL=${step_url}"
            

      - name: verifyReports
        type: Bash
        configuration:
          integrations:
            - name: AdminToken
          inputResources:
            - name: myPropertyBag
          inputSteps:
            - name: GenerateReports
        execution:
          onExecute:
            - echo ${res_myPropertyBag_STEP_URL}
            - |
              curl -o testReportOutput_${res_myPropertyBag_STEP_ID}.txt --location '${res_myPropertyBag_STEP_URL}/stepTestReports' --header 'Authorization: Bearer ${int_AdminToken_token}'
            - ls -la
            - cat testReportOutput_${res_myPropertyBag_STEP_ID}.txt
